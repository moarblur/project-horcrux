# Horcrux Specification

## Purpose
A Horcrux is an encrypted artifact that can encapsulate any type of information. The specification is agnostic to the payload's contents, allowing diverse use cases. EchoVault, for example, employs Horcruxes to store personal thoughts and memories.

## Required Fields
- **title** – short human‑readable identifier for the Horcrux
- **body** – encrypted payload (text or binary)
- **tags** – list of keywords that help categorize the Horcrux

Additional metadata includes a unique identifier, creation and modification timestamps, and optional expiry settings.

## Metadata
Each Horcrux record stores non‑sensitive metadata alongside the ciphertext:
- `id` – unique hash or UUID
- `created_at` – timestamp of creation
- `updated_at` – last modification timestamp
- `expiry` – date/time or view limit after which the content becomes inaccessible
- `recipients` – identifiers for recipients authorized to decrypt

## Encryption Approach
Horcruxes use zero‑knowledge encryption as described in the project README. Client-side WebCrypto derives a symmetric key from a user passphrase, and the plaintext is encrypted before any data leaves the browser. Only ciphertext and metadata are sent to the server.

## Key Management
- User-generated passphrase derives a cryptographic key.
- The key never leaves the client. The server stores only ciphertext and metadata.
- Secure sharing links may include ephemeral secrets or tokens generated by the backend to facilitate decryption by recipients.

## Sharing Flow
1. The creator writes a Horcrux in the browser.
2. Content is encrypted locally using the passphrase-derived key.
3. The encrypted payload and metadata are uploaded to the backend.
4. The backend generates a secure link and optionally notifies recipients.
5. Recipients access the link, authenticate, and retrieve the ciphertext.
6. Recipients decrypt locally with the shared secret or passphrase.
7. Access events are logged immutably for auditing.

## Optional Extensions
- **IPFS Storage** – store encrypted payloads on IPFS while keeping metadata on the server.
- **Blockchain Anchoring** – timestamp metadata hashes on a public blockchain for tamper evidence.
### Data Format
Horcrux records are typically exchanged as JSON documents.
Below is a minimal example:

```json
{
  "id": "4f2b1b7e-9c29-4f3b-a0c4-7acd89c3d2d0",
  "title": "Example",
  "ciphertext": "<hex string>",
  "salt": "<hex>",
  "created_at": "2025-06-07T00:00:00Z",
  "updated_at": "2025-06-07T00:00:00Z",
  "recipients": ["user@example.com"],
  "tags": ["demo"]
}
```
The `ciphertext` field contains the nonce and encrypted data returned by the
client-side encryption routine. The `salt` is used to derive the encryption key.

### Storage Considerations
Payloads may be stored directly in a database along with their metadata or
placed on a decentralized storage network such as IPFS. When using a blockchain
for anchoring, only the hash of the metadata should be placed on-chain due to
block size limitations.

### API Overview
Implementations should expose REST endpoints for creating, retrieving and
revoking Horcruxes. Endpoints are intentionally simple:

```
POST /api/horcrux      -> create new Horcrux
GET  /api/horcrux/{id} -> fetch encrypted payload and metadata
POST /api/horcrux/{id}/revoke -> invalidate sharing links
```
Authentication mechanisms are left to the implementation but should always use
TLS to protect requests in transit.
